<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Background Player</title>
<meta name="theme-color" content="#1DB954">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="YT Background">
<link rel="manifest" href="manifest.json">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#121212;color:#fff;min-height:100vh;padding:20px;display:flex;flex-direction:column;gap:20px}header{text-align:center}
.header h1{color:#1DB954;font-size:28px;margin-bottom:10px}
.status{padding:10px;background:rgba(29,185,84,0.1);border-radius:8px;text-align:center;font-size:14px;color:#1DB954}
.error{background:rgba(255,69,58,0.1);color:#ff453a}
.search-section{display:flex;gap:12px;max-width:600px;width:100%;margin:0 auto}
.search-input{flex:1;padding:14px 20px;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.1);border-radius:50px;color:#fff;font-size:16px;outline:none}
.search-input:focus{outline:none;border-color:#1DB954;background:rgba(255,255,255,0.15)}
.search-btn{width:50px;height:50px;background:#1DB954;border:none;color:#000;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px}
.player-card{max-width:600px;width:100%;background:rgba(255,255,255,0.05);border-radius:12px;padding:20px;margin:0 auto;display:none}
.album-art{width:100%;aspect-ratio:1;background:linear-gradient(135deg,#1DB954,#121212);border-radius:8px;margin-bottom:15px;overflow:hidden;position:relative;background-size:cover;background-position:center}
.track-info{text-align:center;margin-bottom:20px}
.track-title{font-size:20px;font-weight:700;margin-bottom:5px}
.track-artist{font-size:14px;color:rgba(255,255,255,0.7)}
.progress-bar{width:100%;height:4px;background:rgba(255,255,255,0.3);border-radius:2px;margin-bottom:8px;cursor:pointer;position:relative}
.progress-fill{height:100%;background:#1DB954;border-radius:2px;width:0%;transition:width 0.1s}
.time-display{display:flex;justify-content:space-between;font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:15px}
.controls{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:15px}
.control-btn{width:48px;height:48px;background:transparent;border:none;color:#fff;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px}
.control-btn:hover{background:rgba(255,255,255,0.1)}
.play-btn{width:56px;height:56px;background:#1DB954;color:#000;font-size:28px}
.volume-control{display:flex;align-items:center;gap:10px;justify-content:center}
.volume-slider{width:120px;height:4px;background:rgba(255,255,255,0.3);outline:none;border-radius:2px;-webkit-appearance:none}
.volume-slider::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#1DB954;border-radius:50%;cursor:pointer}
.instructions{max-width:600px;width:100%;padding:15px;background:rgba(255,255,255,0.05);border-radius:8px;font-size:14px;line-height:1.6;margin:0 auto}
.instructions code{background:rgba(29,185,84,0.2);padding:2px 6px;border-radius:4px;color:#1DB954}
</style>
</head>
<body>
<div class="header"><h1>üéµ YT Background Player</h1></div>
<div id="status" class="status">Status: Bereit - Video-URL eingeben</div>
<div class="search-section">
<input type="text" id="searchInput" class="search-input" placeholder="YouTube URL oder Video-ID...">
<button class="search-btn" onclick="loadVideo()">üîç</button>
</div>
<div class="player-card" id="playerCard">
<div class="album-art" id="albumArt"></div>
<div class="track-info">
<div class="track-title" id="trackTitle">Lade Video...</div>
<div class="track-artist" id="trackArtist"></div>
</div>
<audio id="audioPlayer" preload="auto"></audio>
<div class="progress-bar" onclick="seekTo(event)">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="time-display">
<span id="currentTime">0:00</span>
<span id="duration">0:00</span>
</div>
<div class="controls">
<button class="control-btn" onclick="skipBackward()">‚èÆ</button>
<button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">‚ñ∂</button>
<button class="control-btn" onclick="skipForward()">‚è≠</button>
</div>
<div class="volume-control">
<span>üîä</span>
<input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100" oninput="setVolume(this.value)">
</div>
</div>
<div class="instructions">
<strong>‚úÖ Funktioniert im Hintergrund!</strong><br>
1. YouTube-URL eingeben (z.B. <code>dQw4w9WgXcQ</code>)<br>
2. Warten bis Audio l√§dt<br>
3. Abspielen<br>
4. <strong>App l√§uft im Hintergrund weiter!</strong>
</div>
<script>
const API='https://inv.tux.pizza/api/v1/videos/';
let audio=document.getElementById('audioPlayer'),playerBtn=document.getElementById('playBtn'),playerCard=document.getElementById('playerCard'),input=document.getElementById('searchInput'),statusEl=document.getElementById('status'),currentVideoId=null,wakeLock=null;

function extractVideoId(input){const match=input.match(/(?:v=|/)([a-zA-Z0-9_-]{11})(?:[?&]|$)/);return match?match[1]:(/^[a-zA-Z0-9_-]{11}$/.test(input)?input:null)}

async function loadVideo(){const inputVal=searchInput.value,videoId=extractVideoId(inputVal);if(!videoId)return showStatus('‚ùå Ung√ºltige URL/ID',true);currentVideoId=videoId;showStatus('üîÑ Lade Video...');try{const res=await fetch(API+videoId);if(!res.ok)throw new Error('Video nicht gefunden');const data=await res.json();const audioUrl=data.adaptiveFormats.find(f=>f.type?.includes('audio/mp4'))?.url;if(!audioUrl)throw new Error('Kein Audio gefunden');audio.src=audioUrl;setupMediaSession(data);playerCard.style.display='block';updateTrackInfo(data);showStatus('‚úÖ Bereit zum Abspielen!');requestWakeLock()}catch(e){showStatus('‚ùå Fehler: '+e.message,true)}}

function setupMediaSession(data){if('mediaSession'in navigator){navigator.mediaSession.metadata=new MediaMetadata({title:data.title,artist:data.author||'YouTube',artwork:[{src:data.videoThumbnails?.[0]?.url||'',sizes:'512x512',type:'image/jpeg'}]});navigator.mediaSession.setActionHandler('play',()=>audio.play());navigator.mediaSession.setActionHandler('pause',()=>audio.pause());navigator.mediaSession.setActionHandler('seekbackward',()=>skipBackward());navigator.mediaSession.setActionHandler('seekforward',()=>skipForward());navigator.mediaSession.setActionHandler('previoustrack',()=>skipBackward());navigator.mediaSession.setActionHandler('nexttrack',()=>skipForward())}}

async function requestWakeLock(){try{if('wakeLock'in navigator){wakeLock=await navigator.wakeLock.request('screen');wakeLock.addEventListener('release',()=>{console.log('Wake Lock released')});showStatus('‚úÖ Wake Lock aktiviert - Hintergrundwiedergabe aktiv!')}}catch(e){console.log('Wake Lock nicht verf√ºgbar:',e)}}

function updateTrackInfo(data){document.getElementById('trackTitle').textContent=data.title;document.getElementById('trackArtist').textContent=data.author||'YouTube';const thumb=data.videoThumbnails?.[0]?.url;if(thumb)document.getElementById('albumArt').style.backgroundImage=`url(${thumb})`}

function togglePlay(){if(audio.paused){audio.play();playerBtn.textContent='‚è∏';updatePlaybackState('playing')}else{audio.pause();playerBtn.textContent='‚ñ∂';updatePlaybackState('paused')}}

function updatePlaybackState(state){if('mediaSession'in navigator){navigator.mediaSession.playbackState=state}}

function skipForward(){audio.currentTime=Math.min(audio.duration,audio.currentTime+10)}
function skipBackward(){audio.currentTime=Math.max(0,audio.currentTime-10)}
function seekTo(e){const bar=e.currentTarget;const clickX=e.offsetX;const width=bar.offsetWidth;audio.currentTime=(clickX/width)*audio.duration}
function setVolume(val){audio.volume=val/100}
function showStatus(msg,isError=false){statusEl.textContent=msg;statusEl.className=isError?'status error':'status'}
function formatTime(sec){const m=Math.floor(sec/60);const s=Math.floor(sec%60);return m+':'+(s<10?'0':'')+s}

audio.addEventListener('loadedmetadata',()=>{document.getElementById('duration').textContent=formatTime(audio.duration)});
audio.addEventListener('timeupdate',()=>{const progress=(audio.currentTime/audio.duration)*100;document.getElementById('progressFill').style.width=progress+'%';document.getElementById('currentTime').textContent=formatTime(audio.currentTime);if('mediaSession'in navigator&&navigator.mediaSession.setPositionState){try{navigator.mediaSession.setPositionState({duration:audio.duration,playbackRate:audio.playbackRate,position:audio.currentTime})}catch(e){}}});
audio.addEventListener('play',()=>{playerBtn.textContent='‚è∏';updatePlaybackState('playing');showStatus('‚ñ∂ Spielt jetzt im Hintergrund!')});
audio.addEventListener('pause',()=>{playerBtn.textContent='‚ñ∂';updatePlaybackState('paused')});
audio.addEventListener('ended',()=>{playerBtn.textContent='‚ñ∂';updatePlaybackState('none');showStatus('‚úÖ Video beendet')});
audio.addEventListener('error',()=>{showStatus('‚ùå Fehler beim Laden',true)});

if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js')}

input.addEventListener('keypress',e=>{if(e.key==='Enter')loadVideo()});
</script>
</body>
</html>
